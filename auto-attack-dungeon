-- Settings
local HEIGHT_ABOVE = 9 -- You float 9 studs above the enemy
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")
local combatRemote = game.ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Combat")

-- Smooth Float System
local bodyPosition = Instance.new("BodyPosition")
bodyPosition.MaxForce = Vector3.new(0, 0, 0)
bodyPosition.P = 1e4
bodyPosition.D = 1000
bodyPosition.Parent = hrp

local bodyGyro = Instance.new("BodyGyro")
bodyGyro.MaxTorque = Vector3.new(0, 0, 0)
bodyGyro.P = 1e4
bodyGyro.D = 500
bodyGyro.Parent = hrp

-- Target Finder
local function getClosestAliveMob()
	local closest, minDist = nil, math.huge
	for _, mob in pairs(workspace.Mobs:GetDescendants()) do
		if mob:IsA("Model") and mob:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("Humanoid") then
			if mob.Humanoid.Health > 0 then
				local dist = (hrp.Position - mob.HumanoidRootPart.Position).Magnitude
				if dist < minDist then
					minDist = dist
					closest = mob
				end
			end
		end
	end
	return closest
end

local currentTarget = nil

-- Floating Combat Loop
game:GetService("RunService").Heartbeat:Connect(function()
	currentTarget = getClosestAliveMob()

	if currentTarget and currentTarget:FindFirstChild("HumanoidRootPart") then
		local mobHRP = currentTarget.HumanoidRootPart
		local floatAbove = mobHRP.Position + Vector3.new(0, HEIGHT_ABOVE, 0)

		-- Enable float and face target
		bodyPosition.MaxForce = Vector3.new(1e5, 1e5, 1e5)
		bodyGyro.MaxTorque = Vector3.new(1e5, 1e5, 1e5)

		bodyPosition.Position = floatAbove
		bodyGyro.CFrame = CFrame.new(hrp.Position, mobHRP.Position)

		-- Attack
		combatRemote:FireServer()
	else
		-- Disable float if no target
		bodyPosition.MaxForce = Vector3.new(0, 0, 0)
		bodyGyro.MaxTorque = Vector3.new(0, 0, 0)
	end
end)

-- Cleanup
humanoid.Died:Connect(function()
	bodyPosition:Destroy()
	bodyGyro:Destroy()
end)
